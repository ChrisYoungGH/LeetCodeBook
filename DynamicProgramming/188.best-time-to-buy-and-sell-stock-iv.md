# 买卖股票的最佳时机 IV（Best Time to Buy and Sell Stock IV）*Hard*
### [买卖股票的最佳时机 IV](https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv)（[Origin](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv)）
## 描述
给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你最多可以完成 k 笔交易。

注意:你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

**示例1:**
```
输入: [2,4,1], k = 2

输出: 2

解释: 在第 1 天 (股票价格 = 2) 的时候买入，在第 2 天 (股票价格 = 4) 的时候卖出，这笔交易所能获得利润 = 4-2 = 2 。
```


**示例 2:**
```
输入: [3,2,6,5,0,3], k = 2

输出: 7

解释: 在第 2 天 (股票价格 = 2) 的时候买入，在第 3 天 (股票价格 = 6) 的时候卖出, 这笔交易所能获得利润 = 6-2 = 4 。
    随后，在第 5 天 (股票价格 = 0) 的时候买入，在第 6 天 (股票价格 = 3) 的时候卖出, 这笔交易所能获得利润 = 3-0 = 3 。
```

## Description
Say you have an array for which the ith element is the price of a given stock on day i.

Design an algorithm to find the maximum profit. You may complete at most k transactions.

**Note:**

You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).

**Example 1:**
```
Input: [2,4,1], k = 2

Output: 2

Explanation: Buy on day 1 (price = 2) and sell on day 2 (price = 4), profit = 4-2 = 2.
```


**Example 2:**
```
Input: [3,2,6,5,0,3], k = 2

Output: 7

Explanation: Buy on day 2 (price = 2) and sell on day 3 (price = 6), profit = 6-2 = 4.
            Then buy on day 5 (price = 0) and sell on day 6 (price = 3), profit = 3-0 = 3.

```


## 股票交易, 最多k次
### 解法
- 对k约束, K <= n/2
- dp[k,i] = max(dp[k,i-1], max(dp[k-1,j-1]+prices[i]-prices[j])), 0<=j<i.
- 优化成一维, 时间O(Kn), 空间O(n).
```c++
class Solution {
public:
    int maxProfit(int K, vector<int>& prices) {
        int n = prices.size();
        if (!n) {
            return 0;
        }
        K = min(K, n / 2);

        vector<int> dp(K+1, 0);
        vector<int> mins(K+1, prices[0]);
        
        for (int i = 1; i < n; i++) {
            for (int k = 1; k <= K; k++) {
                mins[k] = min(mins[k], prices[i] - dp[k-1]);
                dp[k] = max(dp[k], prices[i] - mins[k]);
            }
        }
        
        return dp.back();
    }
};
```